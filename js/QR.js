(()=>{const D=101;let to,last='';const IDS=['prcLicense','email','contactNo','cardCompany','cardPosition'];const el=i=>document.getElementById(i);const shown=i=>{const e=el(i);if(!e)return!1;const s=e.dataset?e.dataset.shown:undefined;if(s==='1'||s==='0')return s==='1';const real=e.dataset?e.dataset.real:'';return String(e.textContent||'').trim()===String(real||'').trim()};const NL=String.fromCharCode(13,10);const utf8=s=>unescape(encodeURIComponent(s||''));const build=()=>{const u=JSON.parse(sessionStorage.getItem('userData')||'{}');if(!u||!u.ok)return'';const p=u.pi||{};const L=['BEGIN:VCARD','VERSION:3.0','FN;CHARSET=UTF-8:'+(p.n||''),'URL:https://uapmnlcorinthian.com'];if(shown('prcLicense')&&(p.prc||''))L.push('NOTE;CHARSET=UTF-8:PRC '+p.prc);if(shown('email')&&(p.e||''))L.push('EMAIL:'+p.e);if(shown('contactNo')){let c=String(p.c||'');while(c.startsWith('0'))c=c.slice(1);if(c)L.push('TEL:0'+c)}if(shown('cardCompany')&&(p.co||''))L.push('ORG;CHARSET=UTF-8:'+p.co);if(shown('cardPosition')&&(p.po||''))L.push('TITLE;CHARSET=UTF-8:'+p.po);L.push('CATEGORIES:Architect,UAP,Manila Corinthian Chapter','END:VCARD');return L.join(NL)};const render=()=>{const s=build();if(!s||s===last)return;last=s;const q=el('qr-vcard');if(!q||!window.QRCode)return;q.innerHTML='';new QRCode(q,{text:utf8(s),width:300,height:300,correctLevel:QRCode.CorrectLevel.H})};const deb=()=>{clearTimeout(to);to=setTimeout(render,D)};document.addEventListener('DOMContentLoaded',()=>{setTimeout(render,500);document.addEventListener('click',e=>{if(e.target.closest('.toggle-sensitive-btn'))deb()});IDS.forEach(id=>{const e=el(id);if(!e)return;new MutationObserver(deb).observe(e,{attributes:true,attributeFilter:['data-shown','class','style','hidden'],characterData:true,childList:true,subtree:true})})})})();
